import{_ as s,o as a,c as o,O as p}from"./chunks/framework.fb7bb97b.js";const l="/G-blog/assets/image-2.e7e1eaf5.png",n="/G-blog/assets/image-1.45ea45c7.png",e="/G-blog/assets/image.fa3980ee.png",m=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"webDeveloper/app/uniapp-ios离线打包(攻略).md","filePath":"webDeveloper/app/uniapp-ios离线打包(攻略).md","lastUpdated":1709120692000}'),t={name:"webDeveloper/app/uniapp-ios离线打包(攻略).md"},r=p('<h2 id="uniapp-ios-本地离线打包-攻略" tabindex="-1">uniapp ios 本地离线打包(攻略) <a class="header-anchor" href="#uniapp-ios-本地离线打包-攻略" aria-label="Permalink to &quot;uniapp ios 本地离线打包(攻略)&quot;">​</a></h2><p>首先我们需要知道 ios 本地离线打包是什么，为什么要使用离线打包，而不使用云打包，按官方的说法&quot;App 离线开发工具包，即 App 离线 SDK，是把 App 运行环境（runtime）封装为原生开发调用接口，开发者可以在自己的 Android 及 iOS 原生开发环境配置工程使用，包括 Android 离线开发 SDK 及 iOS 离线开发 SDK&quot;，实际上好处有：</p><ol><li>本地打包，不需等，有时候云打包人数多时你又着急上线时结果看到需要等 30 分钟(夸张的修辞手法，一般也就 5-6 分钟)后才能打包完成，而本地打包只需要生成一下 App 资源，然后进行打包即可</li><li>本地打包没有代码泄露等风险，并且不需要上传证书(虽然 uniapp 是官宣不会泄露，我也十分相信)</li></ol><h3 id="_1-基础资料" tabindex="-1">1. 基础资料 <a class="header-anchor" href="#_1-基础资料" aria-label="Permalink to &quot;1. 基础资料&quot;">​</a></h3><p>所谓&quot;工欲善其事，必先利其器&quot;所以我们需要先了解一些基础资料，这些资料可以帮助我们更好的理解 uniapp 的打包流程。</p><ol><li><a href="https://nativesupport.dcloud.net.cn/AppDocs/usesdk/ios.html" target="_blank" rel="noreferrer">uniapp 的离线打包流程</a></li><li><a href="https://nativesupport.dcloud.net.cn/AppDocs/download/ios.html" target="_blank" rel="noreferrer">ios 离线 sdk</a></li><li><a href="https://nativesupport.dcloud.net.cn/AppDocs/importfeproject/ios.html" target="_blank" rel="noreferrer">导入 App 资源</a></li><li><a href="https://nativesupport.dcloud.net.cn/AppDocs/usemodule/iOSModuleConfig/common.html" target="_blank" rel="noreferrer">ios 模块配置</a></li><li><a href="https://nativesupport.dcloud.net.cn/AppDocs/package/ios.html" target="_blank" rel="noreferrer">打包发行</a> 以上的这些资料，基本可以完成离线打包，但还是会遇到一些问题，接下来会列举一些我遇到的问题</li></ol><h4 id="所需材料" tabindex="-1">所需材料 <a class="header-anchor" href="#所需材料" aria-label="Permalink to &quot;所需材料&quot;">​</a></h4><ol><li>一个审核通过的企业开发者 developer 账号</li><li>申请好证书和描述文件</li><li>Xcode</li><li>Hbuilderx</li></ol><h3 id="_2-插件配置问题" tabindex="-1">2. 插件配置问题 <a class="header-anchor" href="#_2-插件配置问题" aria-label="Permalink to &quot;2. 插件配置问题&quot;">​</a></h3><h4 id="_2-1-高德地图配置" tabindex="-1">2.1 高德地图配置 <a class="header-anchor" href="#_2-1-高德地图配置" aria-label="Permalink to &quot;2.1 高德地图配置&quot;">​</a></h4><ol><li>[文档]（<a href="https://nativesupport.dcloud.net.cn/AppDocs/usemodule/iOSModuleConfig/map.html#%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BE-%E4%BB%85nvue%E9%A1%B5%E9%9D%A2%E6%94%AF%E6%8C%81" target="_blank" rel="noreferrer">https://nativesupport.dcloud.net.cn/AppDocs/usemodule/iOSModuleConfig/map.html#高德地图-仅nvue页面支持</a>)</li><li>报错：当前运行的基座不包含原生插件[mapSearch]，请在 manifest 中配置该插件，重新制作包括该原生插件的自定义运行基。uniapp 提供的离线基座在使用 uni.chooseLocation 进行位置选择时，离线基座提示不包含原生插件。 原因：文档下面还有一个说明配置，这些依赖库、系统库、依赖资源也需要配置 <img src="'+l+`" alt="alt text"></li></ol><h4 id="_2-2-极光推送配置" tabindex="-1">2.2 极光推送配置 <a class="header-anchor" href="#_2-2-极光推送配置" aria-label="Permalink to &quot;2.2 极光推送配置&quot;">​</a></h4><ol><li><a href="https://go48pg.yuque.com/go48pg/pa41sm/nnc35c?#tl39W" target="_blank" rel="noreferrer">文档</a></li><li>报错：当前运行的基座不包含原生插件[JG-JPush]，请在 manifest 中配置该插件，重新制作包括该原生插件的自定义运行基座 按文档配置应该是没有问题的，但是还是遇到这种情况你需要看一下是否使用了模拟器运行的，使用真机运行即可</li></ol><h3 id="_3-配置-app-模块等问题" tabindex="-1">3. 配置 app 模块等问题 <a class="header-anchor" href="#_3-配置-app-模块等问题" aria-label="Permalink to &quot;3. 配置 app 模块等问题&quot;">​</a></h3><p>在运行中提示：打包时未添加 xxx 模块 请根据“<a href="https://nativesupport.dcloud.net.cn/AppDocs/usemodule/iOSModuleConfig/common.html#%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%9D%97-%E4%B8%89%E6%96%B9sdk" target="_blank" rel="noreferrer">如何配置模块/三方 SDK</a>”配置即可</p><h3 id="ios-更新跳转到-app-store-指定-app-链接" tabindex="-1">ios 更新跳转到 App Store 指定 app 链接 <a class="header-anchor" href="#ios-更新跳转到-app-store-指定-app-链接" aria-label="Permalink to &quot;ios 更新跳转到 App Store 指定 app 链接&quot;">​</a></h3><p>iTunes 提供了接口可查询到 app 在 App Store 上的信息 国外：<a href="https://itunes.apple.com/lookup?id=xxx" target="_blank" rel="noreferrer">https://itunes.apple.com/lookup?id=xxx</a> 国内：<a href="https://itunes.apple.com/cn/lookup?id=xxx" target="_blank" rel="noreferrer">https://itunes.apple.com/cn/lookup?id=xxx</a></p><p>xxx 为你的应用 ID，可在<a href="https://appstoreconnect.apple.com/" target="_blank" rel="noreferrer">App Store Connect</a>上 APP 信息查看</p><ol><li>直接浏览器访问后会下载一个 txt 文件</li><li>打开搜索 trackViewUrl，获取到参数后的内容也就是一个 https 链接</li><li>将 https:// 替换为 itms:// 或者 itms-apps://</li><li>验证用 ios 的手机，在 safari 打开这个链接，会弹窗提示跳转到 App Store</li></ol><h3 id="麦克风授权问题" tabindex="-1">麦克风授权问题 <a class="header-anchor" href="#麦克风授权问题" aria-label="Permalink to &quot;麦克风授权问题&quot;">​</a></h3><p>ios 麦克风授权是弹窗提示用户开启的，添加这以下代码获取麦克风授权</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> appAuthorizeSetting </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getAppAuthorizeSetting</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> isAuth </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> appAuthorizeSetting</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">microphoneAuthorized </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">authorized</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">isAuth) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getSystemInfoSync</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">platform</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ios</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">avaudiosession</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">plus</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ios</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">import</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">AVAudioSession</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">avaudio</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">avaudiosession</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sharedInstance</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">avaudio</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">requestRecordPermission</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">授权麦克风权限完成</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 安卓</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="遇到的问题" tabindex="-1">遇到的问题 <a class="header-anchor" href="#遇到的问题" aria-label="Permalink to &quot;遇到的问题&quot;">​</a></h3><ol><li><p>在 App 提交审核是提示：你的 App 包含 NSUserTrackingUsageDescription，这表示它可能会请求追踪用户。要提交以供审核，请更新你的 App 隐私答复以注明从此 App 中收集的数据将用于追踪目的，或者更新你的 App 二进制文件并上传新的构建版本。 原因：你在 app 中使用了如 JPush 极光、广告等，会出现此时你就需要去去更新 App 的隐私协议，然后重新打包上传即可 <img src="`+n+'" alt="alt text"></p></li><li><p>解决 App Store 上架提示您必须上传 12.9 英寸 iPad Pro（第 2 代）显示屏的截屏 原因：在项目中选择了多种平台，去项目中进行 <img src="'+e+'" alt="alt text"></p></li><li><p>在配置打包证书时报错：Provisioning profile &quot;XX&quot; doesn&#39;t include signing certificate &quot;xx developer<br> 原因：在 xcode 中选择了手动配置证书和描述文件，但并不匹配所导致<br> 解决方案：<a href="https://blog.csdn.net/auccy/article/details/105693590" target="_blank" rel="noreferrer">https://blog.csdn.net/auccy/article/details/105693590</a></p></li><li><p>如果是在 product -&gt; Archive 报错：Profile doesn&#39;t include the selected signing certificate. 原因：如果在配置证书正常时，可能是钥匙串中有重复过期了证书<br> 解决方案：将钥匙串和本 app 有关的证书删除，重新导入后，重启 Xcode，重新打包即可</p></li></ol>',24),i=[r];function c(D,F,u,y,d,h){return a(),o("div",null,i)}const f=s(t,[["render",c]]);export{m as __pageData,f as default};
